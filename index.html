<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="UTF-8">
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #eaf6ff;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
      }
      .container {
        background: white;
        padding: 30px 25px;
        border-radius: 20px;
        box-shadow: 0px 5px 20px rgba(0,0,0,0.1);
        width: 360px;
        text-align: center;
      }
      img {
        width: 140px;
        margin-bottom: 20px;
      }
      h2 {
        margin: 10px 0 25px;
        font-size: 30px;
        line-height: 1.4;
        color: #2d78cf ;
      }
      input[type="email"],
      input[type="password"],
      input[type="text"] {
        width: 90%;
        padding: 12px;
        margin: 10px 0 15px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 14px;
      }
      button[type="submit"] {
        width: 100%;
        padding: 12px;
        background-color: #2d78cf;
        color: white;
        border: none;
        border-radius: 8px;
        margin-top: 10px;
        font-size: 16px;
        cursor: pointer;
      }
.links {
  margin-top: 20px;
}
      .links a {
        color: #2d78cf;
        text-decoration: none;
      } 
      .footer {
        margin-top: 25px;
        font-size: 13px;
        color: red;
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 999;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.5);
      }

      .modal-content {
  background-color: transparent;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: fit-content;
}
    

      .tab-buttons {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-bottom: 20px;
      }

      .tab-buttons button {
        padding: 10px 20px;
        border: none;
        background-color: #2d78cf;
        color: white;
        cursor: pointer;
        border-radius: 6px;
        font-size: 14px;
      }

      .tab {
        display: none;
      }
      .tab.active {
        display: block;
      }

      .launch-btn {
        position: absolute;
        top: 20px;
        right: 20px;
        padding: 10px 15px;
        background-color: #2d78cf;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>

    <!-- Modal -->
    <div id="authModal" class="modal">
      <div class="modal-content">

       <!-- Modal thÃ´ng bÃ¡o lá»—i Ä‘Äƒng kÃ½ -->
<div id="errorModal" class="modal">
  <div class="modal-content">
    <div class="container">
      <h2 style="color: red;">Email Ä‘Ã£ Ä‘Æ°á»£c Ä‘Äƒng kÃ½!</h2>
      <p>Vui lÃ²ng Ä‘Äƒng nháº­p hoáº·c sá»­ dá»¥ng email khÃ¡c.</p>
      <button onclick="closeErrorModal()">ÄÃ³ng</button>
    </div>
  </div>
</div>

        <!-- ÄÄƒng Nháº­p -->
        <div id="login" class="tab active">
          <div class="container">
             <div class="tab-buttons">
          <button onclick="showTab('login')">ÄÄƒng Nháº­p</button>
          <button onclick="showTab('register')">ÄÄƒng KÃ½</button>
        </div>
            <img src="https://imgur.com/XNg24jc.png">
            <h2>Há»† THá»NG ERP</h2>
            <form id="loginForm" onsubmit="handleLogin(event)">
              <input type="email" name="email" placeholder="Email Ä‘Äƒng nháº­p" required>
              <input type="password" name="password" placeholder="Máº­t kháº©u" required>
              <button type="submit">ÄÄƒng Nháº­p</button>
            </form>
<!-- QuÃªn máº­t kháº©u -->
    <div class="links" style="margin-top: 10px;">
      <a href="javascript:void(0);" onclick="showTab('forgotPassword')">QuÃªn máº­t kháº©u?</a>
    </div>
            <div id="responseMessage" style="margin-top: 10px; color: green;"></div>


            <div class="footer">PhÃ¡t triá»ƒn bá»Ÿi Äá»— VÄƒn Thiá»‡u</div>
          </div>
        </div>
              
        <!-- ÄÄƒng KÃ½ -->
        <div id="register" class="tab">
          <div class="container">
            <img src="https://imgur.com/XNg24jc.png">
            <h2>ÄÄ‚NG KÃ</h2>
            <form id="registerForm" onsubmit="handleRegister(event)">
              <input type="text" name="name" placeholder="Há» vÃ  tÃªn" required>
              <input type="email" name="email" placeholder="Email" required>
              <input type="password" name="password" placeholder="Máº­t kháº©u" required>
              <input type="password" name="confirmPassword" placeholder="Nháº­p láº¡i máº­t kháº©u" required>
              <button type="submit">Táº¡o TÃ i Khoáº£n</button>
            </form>
            
            <div class="footer">PhÃ¡t triá»ƒn bá»Ÿi Äá»— VÄƒn Thiá»‡u</div>
          </div>
        </div>
        <!-- QuÃªn máº­t kháº©u -->
<div id="forgotPassword" class="tab">
  <div class="container">
    <h2>QuÃªn máº­t kháº©u?</h2>
    <form id="forgotPasswordForm" onsubmit="handleForgotPassword(event)">
      <input type="email" name="email" placeholder="Nháº­p email cá»§a báº¡n" required>
      <button type="submit">Gá»­i yÃªu cáº§u Ä‘áº·t láº¡i máº­t kháº©u</button>
    </form>
    
    <div id="forgotPasswordMessage" style="margin-top: 10px; color: green;"></div>
    <div class="footer">PhÃ¡t triá»ƒn bá»Ÿi Äá»— VÄƒn Thiá»‡u</div>
  </div>
</div>
      </div>
    </div>


  <script>
  function openModal() {
    document.getElementById("authModal").style.display = "block";
    showTab('login');
  }

  function closeModal() {
    document.getElementById("authModal").style.display = "none";
  }

  function showTab(tabName) {
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(tab => tab.classList.remove('active'));
    document.getElementById(tabName).classList.add('active');
  }

    window.onload = function() {
    document.getElementById("authModal").style.display = "flex";
  };

  document.addEventListener('keydown', function(event) {
    if (event.key === "Escape") {
      event.preventDefault(); // ğŸš« KhÃ´ng cho táº¯t báº±ng Esc
    }
  });

  function handleLogin(e) {
    e.preventDefault();
    const form = document.getElementById("loginForm");
    const data = {
      email: form.email.value,
      password: form.password.value
    };
    google.script.run
      .withSuccessHandler(function(response) {
       if (response.startsWith("ÄÄƒng nháº­p thÃ nh cÃ´ng")) {
      showLoginSuccessModal();
    } else {
      showLoginErrorModal();
    }
      })
      .handleLogin(data);
  }

  function handleRegister(e) {
  e.preventDefault();
  const form = document.getElementById("registerForm");
  if (form.password.value !== form.confirmPassword.value) {
      showPasswordMismatchModal();
    return;
  }
  const data = {
    name: form.name.value,
    email: form.email.value,
    password: form.password.value
  };
  google.script.run
    .withSuccessHandler(function(response) {
      if (response === "Email Ä‘Ã£ Ä‘Æ°á»£c Ä‘Äƒng kÃ½.") {
        showErrorModal();  // Hiá»ƒn thá»‹ modal khi email Ä‘Ã£ Ä‘Äƒng kÃ½
      } else {
        showSuccessModal(); // Hiá»ƒn thá»‹ modal thÃ nh cÃ´ng
      }
    })
    .handleRegister(data);
}

function showErrorModal() {
  document.getElementById("errorModal").style.display = "block";
}

function closeErrorModal() {
  document.getElementById("errorModal").style.display = "none";
}
function showSuccessModal() {
  document.getElementById("successModal").style.display = "block";
}

function closeSuccessModal() {
  document.getElementById("successModal").style.display = "none";
  showTab('login'); // Quay láº¡i form Ä‘Äƒng nháº­p sau khi Ä‘Ã³ng modal
}
// hÃ m Ä‘iá»u khiá»ƒn thÃ´ng bÃ¡o máº­t kháº©u khÃ´ng khá»›p dáº¡ng modal
function showPasswordMismatchModal() {
  document.getElementById("passwordMismatchModal").style.display = "block";
}

function closePasswordMismatchModal() {
  document.getElementById("passwordMismatchModal").style.display = "none";
}
// modal thÃ´ng bÃ¡o Ä‘Äƒng nháº­p thÃ nh cÃ´ng
function showLoginSuccessModal() {
  document.getElementById("loginSuccessModal").style.display = "block";
}

function closeLoginSuccessModal() {
  document.getElementById("loginSuccessModal").style.display = "none";
  // CÃ³ thá»ƒ thÃªm hÃ nh Ä‘á»™ng Ä‘iá»u hÆ°á»›ng náº¿u muá»‘n
}

function showLoginErrorModal() {
  document.getElementById("loginErrorModal").style.display = "block";
}

function closeLoginErrorModal() {
  document.getElementById("loginErrorModal").style.display = "none";
}
  // Cáº­p nháº­t hÃ m showTab Ä‘á»ƒ bao gá»“m quÃªn máº­t kháº©u
  function showTab(tabName) {
    // áº¨n táº¥t cáº£ cÃ¡c tab
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(tab => tab.classList.remove('active'));

    // Hiá»ƒn thá»‹ tab Ä‘Æ°á»£c chá»n
    document.getElementById(tabName).classList.add('active');
  }

  // HÃ m khá»Ÿi táº¡o ban Ä‘áº§u khi trang táº£i lÃªn
  window.onload = function() {
    document.getElementById("authModal").style.display = "flex";
  };

  // NgÄƒn khÃ´ng cho táº¯t modal báº±ng phÃ­m Esc
  document.addEventListener('keydown', function(event) {
    if (event.key === "Escape") {
      event.preventDefault(); // ğŸš« KhÃ´ng cho táº¯t báº±ng Esc
    }
  });
  // Xá»­ lÃ½ quÃªn máº­t kháº©u
function handleForgotPassword(event) {
    event.preventDefault();
    
    const form = document.getElementById("forgotPasswordForm");
    const email = form.email.value;

    // Gá»­i Ä‘áº¿n Apps Script xá»­ lÃ½
    google.script.run
      .withSuccessHandler(function(response) {
        document.getElementById("forgotPasswordMessage").innerText = response;
      })
      .withFailureHandler(function(error) {
        document.getElementById("forgotPasswordMessage").innerText = "ÄÃ£ xáº£y ra lá»—i. Vui lÃ²ng thá»­ láº¡i sau.";
        console.error("Lá»—i khi gá»­i yÃªu cáº§u quÃªn máº­t kháº©u:", error);
      })
      .handleForgotPassword({ email: email });
  }
</script>
<!-- Modal Ä‘Äƒng kÃ½ thÃ nh cÃ´ng -->
<div id="successModal" class="modal">
  <div class="modal-content">
    <div class="container">
      <h2 style="color: green;">ÄÄƒng kÃ½ thÃ nh cÃ´ng!</h2>
      <p>Báº¡n cÃ³ thá»ƒ Ä‘Äƒng nháº­p báº±ng tÃ i khoáº£n vá»«a táº¡o.</p>
      <button onclick="closeSuccessModal()">ÄÄƒng nháº­p ngay</button>
    </div>
  </div>
</div>
<!-- Modal máº­t kháº©u khÃ´ng khá»›p -->
<div id="passwordMismatchModal" class="modal">
  <div class="modal-content">
    <div class="container">
      <h2 style="color: red;">Lá»—i!</h2>
      <p>Máº­t kháº©u khÃ´ng khá»›p.</p>
      <button onclick="closePasswordMismatchModal()">Thá»­ láº¡i</button>
    </div>
  </div>
</div>
 <!--  âœ… Modal: ÄÄƒng nháº­p thÃ nh cÃ´ng -->
<div id="loginSuccessModal" class="modal">
  <div class="modal-content">
    <div class="container">
      <h2 style="color: green;">ÄÄƒng nháº­p thÃ nh cÃ´ng!</h2>
      <p>ChÃ o má»«ng báº¡n quay trá»Ÿ láº¡i.</p>
      <button onclick="closeLoginSuccessModal()">Tiáº¿p tá»¥c</button>
    </div>
  </div>
</div>
<!-- âŒ Modal: Sai email hoáº·c máº­t kháº©u -->
<div id="loginErrorModal" class="modal">
  <div class="modal-content">
    <div class="container">
      <h2 style="color: red;">ÄÄƒng nháº­p tháº¥t báº¡i</h2>
      <p>Email hoáº·c máº­t kháº©u khÃ´ng Ä‘Ãºng. Vui lÃ²ng thá»­ láº¡i.</p>
      <button onclick="closeLoginErrorModal()">Thá»­ láº¡i</button>
    </div>
  </div>
</div>
  </body>
</html>
